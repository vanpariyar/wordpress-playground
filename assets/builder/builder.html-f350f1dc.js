import"../modulepreload-polyfill-3cfb730f.js";import{_ as N}from"../preload-helper-cf010ec4.js";const D=N(()=>import("https://playground.wordpress.net/client/index.js"),[]),O=fetch("https://playground.wordpress.net/blueprint-schema.json").then(n=>n.json()),Q=(n,o)=>{if(!n||typeof n!="object"||!("$ref"in n))return n;const e=n.$ref.substr(2).split("/");let s=o;for(const a of e){if(!(a in s))throw new Error(`Invalid reference: "${n.$ref}"`);s=s[a]}return{...n,...s}},R=Symbol("reader"),P=(n,o=null)=>{if(n[R])return n[R];o||(o=n);const e=new Proxy(n,{get:(s,a,i)=>{const r=Reflect.get(s,a,i);return r&&typeof r=="object"?P(Q(r,o),o):r}});return n[R]=e,e},A=(n,{column:o,row:e})=>{const a=n.getValue().split(`
`),i=String(a[e]),r=i.indexOf(":"),c=[];if(r>-1&&o>r){const u=i.indexOf('"'),m=i.indexOf('"',1+u);c.push(i.substring(1+u,m))}let d=0;for(;i[d]===" "||i[d]==="	";)d++;let t=-1+e;for(;t>=0;){const u=a[t].indexOf('"'),m=a[t].indexOf('"',1+u);u>-1&&u<d&&(c.push(a[t].substring(1+u,m)),d=u),t--}return c},C=(n,o,{column:e,row:s},a=0)=>{const r=n.getValue().split(`
`);let c=-1+s;for(;c>=0;){if(r[c].indexOf("{")>-1){if(--a<0)return null;c--;continue}let t=0;for(;r[c][t]===" "||r[c][t]==="	";)t++;const u=r[c].indexOf('"'),m=r[c].indexOf('"',1+u),f=r[c].indexOf('"',1+m),p=r[c].indexOf('"',1+f);if(u>-1&&u===t){const b=r[c].substring(1+u,m);if(o===b)return r[c].substring(1+f,p)}c--}return null},q=(n,{column:o,row:e})=>{const a=n.getValue().split(`
`);let i=-1+e,r=0;for(;a[e][r]===" "||a[e][r]==="	";)r++;const c=[];for(;i>=0;){const d=a[i].indexOf("{");if(d>-1&&d<r)break;const t=a[i].indexOf('"'),u=a[i].indexOf('"',1+t);t>-1&&t===r&&c.push(a[i].substring(1+t,u)),i--}return c},I=async n=>{const o=await O;return P(o).definitions.StepDefinition.oneOf.filter(s=>s.properties.step.const===n).map(s=>s.properties).flat().pop()},F=async(n,o)=>(await O).definitions.StepDefinition.oneOf.filter(s=>s.properties.step.const===n).map(s=>Object.keys(s.properties)).flat().filter(s=>s.substr(0,o.length)===o).filter(s=>!["step","progress"].includes(s)),M=async(n,o,e)=>{const s=await O;return P(s).definitions.StepDefinition.oneOf.filter(i=>i.properties.step.const===n).map(i=>i.properties[e].anyOf).flat().filter(i=>!o||i.properties.resource.const===o).map(i=>i.properties).flat().pop()},j=async(n,o,e,s,a)=>{if(!o&&!s)return["resource"];const i=await O;return P(i).definitions.StepDefinition.oneOf.filter(c=>c.properties.step.const===n).map(c=>c.properties[e].anyOf).flat().filter(c=>!o||c.properties.resource.const===o).map(c=>s===null?Object.keys(c.properties):c.properties.resource.const).flat().filter(c=>!["resource"].includes(c))},K=async n=>{const o=await O;return P(o).definitions.StepDefinition.oneOf.map(s=>s.properties.step.const).filter(s=>s.substr(0,n.length)===n)},W=async n=>{const o=await O;return P(o).definitions.SupportedPHPVersion.enum.filter(s=>s.substr(0,n.length)===n)},z=async n=>{const o=await O,e=P(o);return Object.keys(e.definitions.Blueprint.properties).filter(s=>s[0]!=="$"&&s.substr(0,n.length)===n)},H=async n=>{const o=await O,e=P(o);return Object.keys(e.definitions.Blueprint.properties.features.properties).filter(s=>s[0]!=="$"&&s.substr(0,n.length)===n)};let S=null;const Z=async(n,o,e,s,a)=>{const i=[],r=A(n,e),d=n.getValue().split(`
`),u=String(d[e.row]).indexOf(":"),{row:m,column:f}=e,p=!d[m][-1+f]||d[m][-1+f]===" "?'"':"",b=!d[m][f]||d[m][f]===" "?'"':"";if(r.length===3&&s.length>=3&&r.join("<")==="slug<pluginZipFile<steps"){const l=new URLSearchParams;l.set("action","query_plugins"),l.set("request[page]","1"),l.set("request[per_page]","200"),l.set("request[locale]","en_US"),l.set("request[search]",s),l.set("request[wp_version]","6.4");const g=new URLSearchParams;g.set("url",`http://api.wordpress.org/plugins/info/1.2/?${l}`),S&&(clearTimeout(S),S=null),document.body.setAttribute("data-loading",!0),S=setTimeout(async()=>{try{(await(await fetch(`https://playground.wordpress.net/plugin-proxy.php?${g}`)).json())?.plugins.forEach(h=>{var E=new DOMParser().parseFromString(h.name,"text/html");const x=E.documentElement.textContent;a(null,[{name:h.slug,value:p+h.slug+b,score:1,meta:x}])})}finally{document.body.setAttribute("data-loading",!1)}},250)}if(r.length===3&&s.length>=3&&r.join("<")==="slug<themeZipFile<steps"){const l=new URLSearchParams;l.set("action","query_themes"),l.set("request[page]","1"),l.set("request[per_page]","200"),l.set("request[locale]","en_US"),l.set("request[search]",s),l.set("request[wp_version]","6.4");const g=new URLSearchParams;g.set("url",`http://api.wordpress.org/themes/info/1.2/?${l}`),S&&(clearTimeout(S),S=null),document.body.setAttribute("data-loading",!0),S=setTimeout(async()=>{try{(await(await fetch(`https://playground.wordpress.net/plugin-proxy.php?${g}`)).json())?.themes.forEach(h=>{var E=new DOMParser().parseFromString(h.name,"text/html");const x=E.documentElement.textContent;a(null,[{name:h.slug,value:p+h.slug+b,score:1,meta:x}])})}finally{document.body.setAttribute("data-loading",!1)}},250)}switch(r[0]){case"preferredVersions":{const l=await q(n,e);i.push(...["wp","php"].filter(g=>!l.includes(g)));break}case"wp":i.push("latest");break;case"php":i.push(...await W(s));break;case"steps":{const l=await q(n,e),g=C(n,"step",e);if(g){const y=await F(g,s);i.push(...y.filter(w=>!l.includes(w)))}else i.push("step")}break;case"step":i.push(...await K(s));break;case"features":i.push(...await H(s));break;case void 0:i.push(...await z(s));break;default:switch(r[-1+r.length]){case"steps":{const l=C(n,"step",e,1),g=C(n,"resource",e,1);if(r.length===2){if(u===-1){const y=await q(n,e),w=await j(l,g,r[-2+r.length],null);i.push(...w.filter(h=>!y.includes(h)))}}else r.length===3&&r[0]==="resource"&&i.push(...await j(l,g,r[-2+r.length],r[0]))}break}break}for(const l of i)a(null,[{name:l,value:p+l+b,score:1,meta:"Blueprint Schema"}])};let T;const V=n=>{console.error(n),T||(T=document.getElementById("error-output"));const o=`<head><style>body{ color: red; font-family: monospace; } pre{ white-space: pre-wrap; } p{ margin: 0.25rem; }</style></head><body>${n}</body>`;T.setAttribute("srcdoc",o)},$=n=>{T||(T=document.getElementById("error-output")),T.setAttribute("srcdoc","")},U=(n,o={})=>{const e=n.getSession().getValue(),s=JSON.stringify(o,null,2)+`
`;s!==e&&(n.getSession().setValue(s),s!==e&&n.getSession().setValue(s))};function J(n){const o=JSON.parse(n.getValue());return o.features&&o.features.networking===!1&&(o.features.networking=!0),o}let B=0;const G=(await D).startPlaygroundWeb,k=async n=>{const o=++B,e=document.createElement("iframe");let s=document.getElementById("wp-playground");s.parentNode.insertBefore(e,s),s.remove(),s=e,e.id="wp-playground";try{document.body.setAttribute("data-starting",!0),$();const a=J(n);U(n,a);const i=JSON.stringify(a);window.location.hash=i;const r=JSON.parse(i);await G({iframe:s,remoteUrl:"https://playground.wordpress.net/remote.html",blueprint:r})}catch(a){o===B&&V(a)}finally{o===B&&document.body.setAttribute("data-starting",!1)}},X=n=>{const o=decodeURI(window.location.hash.substr(1));try{let e="";try{e=JSON.parse(atob(o))}catch{e=JSON.parse(o)}return e}catch(e){console.error(e)}};function L(){const n=document.querySelector("button#run"),o=document.querySelector("button#new-tab"),e=ace.edit("jsontext");e.setTheme("ace/theme/github_dark"),e.session.setMode("ace/mode/json");const s=ace.require("ace/ext/language_tools");s.setCompleters([]),s.addCompleter({triggerCharacters:['"'],getCompletions:Z}),e.setOptions({enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!0,useSoftTabs:!0,tabSize:2}),e.getSession().on("change",async t=>{if(t.action!=="insert")return;const m=e.getValue().split(`
`);if(t.start.row===t.end.row&&1<Math.abs(t.start.column-t.end.column)&&m[t.end.row][t.end.column]==='"'){e.moveCursorTo(t.end.row,t.end.column+1);return}if(m[t.end.row][t.end.column])return;const f=t.lines.join(`
`),p=A(e,t.end);if(!(f.length>1)){if(f===":"){const b=m[t.start.row].indexOf(":");if(b>-1&&b<t.start.column)return;if(p.length===1&&p[0]==="landingPage"&&(e.getSession().insert({row:t.end.row,column:t.end.column},' ""'),e.moveCursorTo(t.end.row,1+t.end.column)),p.length===1&&p[0]==="preferredVersions"&&(e.getSession().insert({row:t.end.row,column:t.end.column}," {}"),e.moveCursorTo(t.end.row,1+t.end.column)),p.length===2&&p[1]==="preferredVersions"&&(e.getSession().insert({row:t.end.row,column:t.end.column},' ""'),e.moveCursorTo(t.end.row,1+t.end.column),setTimeout(()=>e.execCommand("startAutocomplete"),0)),p.length===1&&(p[0]==="steps"||p[0]==="features")&&(e.getSession().insert({row:t.end.row,column:t.end.column}," {}"),e.moveCursorTo(t.end.row,1+t.end.column)),p.length===3&&p[2]==="steps"){const l=C(e,"step",t.end,1),g=C(e,"resource",t.end),w=(await M(l,g,p[1]))[p[0]];w?.type==="string"?(e.getSession().insert({row:t.end.row,column:t.end.column},' ""'),e.moveCursorTo(t.end.row,2+t.end.column),e.execCommand("startAutocomplete")):w?.type==="object"&&(e.getSession().insert({row:t.end.row,column:t.end.column}," {}"),e.moveCursorTo(t.end.row,2+t.end.column))}if(p.length===2&&p[1]==="steps"){const l=await C(e,"step",t.end),y=(await I(l))[p[0]]??null,w=y.type??null,h=y.$ref;w==="string"?(e.getSession().insert({row:t.end.row,column:t.end.column},' ""'),e.moveCursorTo(t.end.row,2+t.end.column)):h==="#/definitions/FileReference"&&(e.getSession().insert({row:t.end.row,column:t.end.column}," {}"),e.moveCursorTo(t.end.row,2+t.end.column))}}else if(f==="["){e.getSession().insert({row:t.end.row,column:t.start.column+1},"]");return}else if(f==="{"){e.getSession().insert({row:t.end.row,column:t.start.column+1},"}");return}}}),n.addEventListener("click",()=>{try{$(),k(e)}catch(t){V(t)}});let a;o.addEventListener("click",()=>{k(e);const t=new URLSearchParams;t.set("mode","seamless");const u=`https://playground.wordpress.net/?${t}#`+JSON.stringify(J(e));a&&a.close(),a=window.open(u,"_blank")}),Y().then(t=>{U(e,t),k(e)}),e.commands.addCommand({name:"Run Blueprint",bindKey:{win:"Ctrl-Enter|Ctrl-S",mac:"Command-Enter|Command-S"},exec:t=>k(t),readOnly:!1});const i=document.querySelector("button#save"),r=document.querySelector("button#open"),c=()=>{const t=`data:application/json;base64,${btoa(JSON.stringify(JSON.parse(e.getValue()),null,2))}`,u=document.createElement("a");u.setAttribute("href",t),u.setAttribute("download",`blueprint-${new Date().toISOString()}.json`),u.click()},d=()=>{const t=document.createElement("input");t.setAttribute("type","file"),t.addEventListener("change",u=>{[...t.files].forEach(m=>{const f=new FileReader;f.addEventListener("load",()=>{e.setValue(JSON.stringify(JSON.parse(f.result),null,2)),e.moveCursorTo(0,0),k(e)}),f.readAsText(m)})}),t.click()};i.addEventListener("click",c),r.addEventListener("click",d),e.commands.addCommand({name:"Run Blueprint",bindKey:{win:"Ctrl-S",mac:"Command-S"},exec:t=>k(t),readOnly:!1})}const _={landingPage:"/wp-admin/",phpExtensionBundles:["kitchen-sink"],preferredVersions:{php:"7.4",wp:"5.9"},steps:[{step:"login",username:"admin",password:"password"}]};async function Y(){if(window.location.hash)return X();const n=new URLSearchParams(window.location.search);if(n.has("blueprint-url"))try{const o=new URL(n.get("blueprint-url"));return o.hostname==="github.com"&&(o.pathname=o.pathname.replace(/^\/([^/]+)\/([^/]+)\/blob/,"/$1/$2/"),o.hostname="raw.githubusercontent.com"),console.log("blueprintUrl.toString()",o.toString()),await(await fetch(o.toString())).json()}catch(o){return V(o),_}return _}document.readyState!=="loading"?L():document.addEventListener("DOMContentLoaded",L);
