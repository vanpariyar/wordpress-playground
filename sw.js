function h(r){return r.pathname.startsWith("/scope:")}function g(r){return h(r)?r.pathname.split("/")[1].split(":")[1]:null}function S(r,e){let t=new URL(r);if(h(t))if(e){const s=t.pathname.split("/");s[1]=`scope:${e}`,t.pathname=s.join("/")}else t=v(t);else if(e){const s=t.pathname==="/"?"":t.pathname;t.pathname=`/scope:${e}${s}`}return t}function v(r){if(!h(r))return r;const e=new URL(r),t=e.pathname.split("/");return e.pathname="/"+t.slice(2).join("/"),e}const C=function(){return typeof process<"u"&&process.release?.name==="node"?"NODE":typeof window<"u"?"WEB":typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?"WORKER":"NODE"}();if(C==="NODE"){let r=function(t){return new Promise(function(s,n){t.onload=t.onerror=function(o){t.onload=t.onerror=null,o.type==="load"?s(t.result):n(new Error("Failed to read the blob/file"))}})},e=function(){const t=new Uint8Array([1,2,3,4]),n=new File([t],"test").stream();try{return n.getReader({mode:"byob"}),!0}catch{return!1}};if(typeof File>"u"){class t extends Blob{constructor(n,o,i){super(n);let a;i?.lastModified&&(a=new Date),(!a||isNaN(a.getFullYear()))&&(a=new Date),this.lastModifiedDate=a,this.lastModified=a.getMilliseconds(),this.name=o||""}}global.File=t}typeof Blob.prototype.arrayBuffer>"u"&&(Blob.prototype.arrayBuffer=function(){const s=new FileReader;return s.readAsArrayBuffer(this),r(s)}),typeof Blob.prototype.text>"u"&&(Blob.prototype.text=function(){const s=new FileReader;return s.readAsText(this),r(s)}),(typeof Blob.prototype.stream>"u"||!e())&&(Blob.prototype.stream=function(){let t=0;const s=this;return new ReadableStream({type:"bytes",autoAllocateChunkSize:512*1024,async pull(n){const o=n.byobRequest.view,a=await s.slice(t,t+o.byteLength).arrayBuffer(),p=new Uint8Array(a);new Uint8Array(o.buffer).set(p);const l=p.byteLength;n.byobRequest.respond(l),t+=l,t>=s.size&&n.close()}})})}if(C==="NODE"&&typeof CustomEvent>"u"){class r extends Event{constructor(t,s={}){super(t,s),this.detail=s.detail}initCustomEvent(){}}globalThis.CustomEvent=r}const b={0:"No error occurred. System call completed successfully.",1:"Argument list too long.",2:"Permission denied.",3:"Address in use.",4:"Address not available.",5:"Address family not supported.",6:"Resource unavailable, or operation would block.",7:"Connection already in progress.",8:"Bad file descriptor.",9:"Bad message.",10:"Device or resource busy.",11:"Operation canceled.",12:"No child processes.",13:"Connection aborted.",14:"Connection refused.",15:"Connection reset.",16:"Resource deadlock would occur.",17:"Destination address required.",18:"Mathematics argument out of domain of function.",19:"Reserved.",20:"File exists.",21:"Bad address.",22:"File too large.",23:"Host is unreachable.",24:"Identifier removed.",25:"Illegal byte sequence.",26:"Operation in progress.",27:"Interrupted function.",28:"Invalid argument.",29:"I/O error.",30:"Socket is connected.",31:"There is a directory under that path.",32:"Too many levels of symbolic links.",33:"File descriptor value too large.",34:"Too many links.",35:"Message too large.",36:"Reserved.",37:"Filename too long.",38:"Network is down.",39:"Connection aborted by network.",40:"Network unreachable.",41:"Too many files open in system.",42:"No buffer space available.",43:"No such device.",44:"There is no such file or directory OR the parent directory does not exist.",45:"Executable file format error.",46:"No locks available.",47:"Reserved.",48:"Not enough space.",49:"No message of the desired type.",50:"Protocol not available.",51:"No space left on device.",52:"Function not supported.",53:"The socket is not connected.",54:"Not a directory or a symbolic link to a directory.",55:"Directory not empty.",56:"State not recoverable.",57:"Not a socket.",58:"Not supported, or operation not supported on socket.",59:"Inappropriate I/O control operation.",60:"No such device or address.",61:"Value too large to be stored in data type.",62:"Previous owner died.",63:"Operation not permitted.",64:"Broken pipe.",65:"Protocol error.",66:"Protocol not supported.",67:"Protocol wrong type for socket.",68:"Result too large.",69:"Read-only file system.",70:"Invalid seek.",71:"No such process.",72:"Reserved.",73:"Connection timed out.",74:"Text file busy.",75:"Cross-device link.",76:"Extension: Capabilities insufficient."};function $(r){const e=typeof r=="object"?r?.errno:null;if(e in b)return b[e]}function u(r=""){return function(t,s,n){const o=n.value;n.value=function(...i){try{return o.apply(this,i)}catch(a){const p=typeof a=="object"?a?.errno:null;if(p in b){const l=b[p],w=typeof i[1]=="string"?i[1]:null,m=w!==null?r.replaceAll("{path}",w):r;throw new Error(`${m}: ${l}`,{cause:a})}throw a}}}}const q="playground-log",x=(r,...e)=>{D.dispatchEvent(new CustomEvent(q,{detail:{log:r,args:e}}))},F=(r,...e)=>{switch(typeof r.message=="string"?Reflect.set(r,"message",k(r.message)):r.message.message&&typeof r.message.message=="string"&&Reflect.set(r.message,"message",k(r.message.message)),r.severity){case"Debug":console.debug(r.message,...e);break;case"Info":console.info(r.message,...e);break;case"Warn":console.warn(r.message,...e);break;case"Error":console.error(r.message,...e);break;case"Fatal":console.error(r.message,...e);break;default:console.log(r.message,...e)}},j=r=>r instanceof Error?[r.message,r.stack].join(`
`):JSON.stringify(r,null,2),A=[],T=r=>{A.push(r)},E=r=>{if(r.raw===!0)T(r.message);else{const e=G(typeof r.message=="object"?j(r.message):r.message,r.severity??"Info",r.prefix??"JavaScript");T(e)}};class H extends EventTarget{constructor(e=[]){super(),this.handlers=e,this.fatalErrorEvent="playground-fatal-error"}getLogs(){return this.handlers.includes(E)?[...A]:(this.error(`Logs aren't stored because the logToMemory handler isn't registered.
				If you're using a custom logger instance, make sure to register logToMemory handler.
			`),[])}logMessage(e,...t){for(const s of this.handlers)s(e,...t)}log(e,...t){this.logMessage({message:e,severity:void 0,prefix:"JavaScript",raw:!1},...t)}debug(e,...t){this.logMessage({message:e,severity:"Debug",prefix:"JavaScript",raw:!1},...t)}info(e,...t){this.logMessage({message:e,severity:"Info",prefix:"JavaScript",raw:!1},...t)}warn(e,...t){this.logMessage({message:e,severity:"Warn",prefix:"JavaScript",raw:!1},...t)}error(e,...t){this.logMessage({message:e,severity:"Error",prefix:"JavaScript",raw:!1},...t)}}const _=()=>{try{if(process.env.NODE_ENV==="test")return[E,x]}catch{}return[E,F,x]},D=new H(_()),k=r=>r.replace(/\t/g,""),G=(r,e,t)=>{const s=new Date,n=new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"short",day:"2-digit",timeZone:"UTC"}).format(s).replace(/ /g,"-"),o=new Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1,timeZone:"UTC",timeZoneName:"short"}).format(s),i=n+" "+o;return r=k(r),`[${i}] ${t} ${e}: ${r}`},J=r=>{r.addEventListener("activate",()=>{r.clients.matchAll().then(e=>{const t={numberOfOpenPlaygroundTabs:e.filter(s=>s.frameType==="top-level").length};for(const s of e)s.postMessage(t)})})};function U(...r){function e(o){return o.substring(o.length-1)==="/"}let t=r.join("/");const s=t[0]==="/",n=e(t);return t=W(t),!t&&!s&&(t="."),t&&n&&!e(t)&&(t+="/"),t}function z(r){if(r==="/")return"/";r=W(r);const e=r.lastIndexOf("/");return e===-1?"":e===0?"/":r.substr(0,e)}function W(r){const e=r[0]==="/";return r=K(r.split("/").filter(t=>!!t),!e).join("/"),(e?"/":"")+r.replace(/\/$/,"")}function K(r,e){let t=0;for(let s=r.length-1;s>=0;s--){const n=r[s];n==="."?r.splice(s,1):n===".."?(r.splice(s,1),t++):t&&(r.splice(s,1),t--)}if(e)for(;t;t--)r.unshift("..");return r}var V=Object.defineProperty,Z=Object.getOwnPropertyDescriptor,d=(r,e,t,s)=>{for(var n=s>1?void 0:s?Z(e,t):e,o=r.length-1,i;o>=0;o--)(i=r[o])&&(n=(s?i(e,t,n):i(n))||n);return s&&n&&V(e,t,n),n};const f=class c{static readFileAsText(e,t){return new TextDecoder().decode(c.readFileAsBuffer(e,t))}static readFileAsBuffer(e,t){return e.readFile(t)}static writeFile(e,t,s){e.writeFile(t,s)}static unlink(e,t){e.unlink(t)}static mv(e,t,s){try{const n=e.lookupPath(t).node.mount,o=c.fileExists(e,s)?e.lookupPath(s).node.mount:e.lookupPath(z(s)).node.mount;n.mountpoint!==o.mountpoint?(c.copyRecursive(e,t,s),c.rmdir(e,t,{recursive:!0})):e.rename(t,s)}catch(n){const o=$(n);throw o?new Error(`Could not move ${t} to ${s}: ${o}`,{cause:n}):n}}static rmdir(e,t,s={recursive:!0}){s?.recursive&&c.listFiles(e,t).forEach(n=>{const o=`${t}/${n}`;c.isDir(e,o)?c.rmdir(e,o,s):c.unlink(e,o)}),e.rmdir(t)}static listFiles(e,t,s={prependPath:!1}){if(!c.fileExists(e,t))return[];try{const n=e.readdir(t).filter(o=>o!=="."&&o!=="..");if(s.prependPath){const o=t.replace(/\/$/,"");return n.map(i=>`${o}/${i}`)}return n}catch(n){return D.error(n,{path:t}),[]}}static isDir(e,t){return c.fileExists(e,t)?e.isDir(e.lookupPath(t,{follow:!0}).node.mode):!1}static isFile(e,t){return c.fileExists(e,t)?e.isFile(e.lookupPath(t,{follow:!0}).node.mode):!1}static symlink(e,t,s){return e.symlink(t,s)}static isSymlink(e,t){return c.fileExists(e,t)?e.isLink(e.lookupPath(t).node.mode):!1}static readlink(e,t){return e.readlink(t)}static realpath(e,t){return e.lookupPath(t,{follow:!0}).path}static fileExists(e,t){try{return e.lookupPath(t),!0}catch{return!1}}static mkdir(e,t){e.mkdirTree(t)}static copyRecursive(e,t,s){const n=e.lookupPath(t).node;if(e.isDir(n.mode)){e.mkdirTree(s);const o=e.readdir(t).filter(i=>i!=="."&&i!=="..");for(const i of o)c.copyRecursive(e,U(t,i),U(s,i))}else e.writeFile(s,e.readFile(t))}};d([u('Could not read "{path}"')],f,"readFileAsText",1);d([u('Could not read "{path}"')],f,"readFileAsBuffer",1);d([u('Could not write to "{path}"')],f,"writeFile",1);d([u('Could not unlink "{path}"')],f,"unlink",1);d([u('Could not remove directory "{path}"')],f,"rmdir",1);d([u('Could not list files in "{path}"')],f,"listFiles",1);d([u('Could not stat "{path}"')],f,"isDir",1);d([u('Could not stat "{path}"')],f,"isFile",1);d([u('Could not stat "{path}"')],f,"realpath",1);d([u('Could not stat "{path}"')],f,"fileExists",1);d([u('Could not create directory "{path}"')],f,"mkdir",1);d([u('Could not copy files from "{path}"')],f,"copyRecursive",1);(function(){return typeof process<"u"&&process.release?.name==="node"?"NODE":typeof window<"u"?"WEB":typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?"WORKER":"NODE"})();ReadableStream.prototype[Symbol.asyncIterator]||(ReadableStream.prototype[Symbol.asyncIterator]=async function*(){const r=this.getReader();try{for(;;){const{done:e,value:t}=await r.read();if(e)return;yield t}}finally{r.releaseLock()}},ReadableStream.prototype.iterate=ReadableStream.prototype[Symbol.asyncIterator]);function X(r,e){for(const t of e)if(new RegExp(t.match).test(r))return r.replace(t.match,t.replacement);return r}const Y=25e3;let Q=0;function ee(){return++Q}function I(r,e,t=Y){return new Promise((s,n)=>{const o=a=>{a.data.type==="response"&&a.data.requestId===e&&(r.removeEventListener("message",o),clearTimeout(i),s(a.data.response))},i=setTimeout(()=>{n(new Error("Request timed out")),r.removeEventListener("message",o)},t);r.addEventListener("message",o)})}function te(r){const{handleRequest:e=re}=r;self.addEventListener("fetch",t=>{const s=new URL(t.request.url);if(s.pathname.startsWith(self.location.pathname))return;if(!h(s)){let o;try{o=new URL(t.request.referrer)}catch{return}if(!h(o))return}const n=e(t);n&&t.respondWith(n)})}async function re(r){r.preventDefault();const e=new URL(r.request.url),t=await N(r);if(t.status===404&&(t.headers.get("x-backfill-from")==="remote-host"||t.headers.get("x-file-type")==="static")){const s=await B(r.request,{url:e,credentials:"omit"});return fetch(s)}return t}async function N(r){let e=new URL(r.request.url);if(!h(e))try{const i=new URL(r.request.referrer);e=S(e,g(i))}catch{}const t=r.request.headers.get("content-type"),s=r.request.method==="POST"?new Uint8Array(await r.request.clone().arrayBuffer()):void 0,n={};for(const i of r.request.headers.entries())n[i[0]]=i[1];let o;try{const i={method:"request",args:[{body:s,url:e.toString(),method:r.request.method,headers:{...n,Host:e.host,"User-agent":self.navigator.userAgent,"Content-type":t}}]},a=g(e);if(a===null)throw new Error(`The URL ${e.toString()} is not scoped. This should not happen.`);const p=await P(i,a);o=await I(self,p),delete o.headers["x-frame-options"]}catch(i){throw console.error(i,{url:e.toString()}),i}return new Response(o.bytes,{headers:o.headers,status:o.httpStatusCode})}async function P(r,e){const t=ee();for(const s of await self.clients.matchAll({includeUncontrolled:!0}))s.postMessage({...r,scope:e,requestId:t});return t}async function B(r,e){const t=["GET","HEAD"].includes(r.method)||"body"in e?void 0:await r.blob();return new Request(e.url||r.url,{body:t,method:r.method,headers:r.headers,referrer:r.referrer,referrerPolicy:r.referrerPolicy,mode:r.mode==="navigate"?"same-origin":r.mode,credentials:r.credentials,cache:r.cache,redirect:r.redirect,integrity:r.integrity,...e})}const se=[{match:/^\/(.*?)(\/wp-(content|admin|includes)\/.*)/g,replacement:"$2"}],ne="166a91135b6cebcf0054d970a19cfb94f4ba02ae",M="playground-cache",L=`${M}-${ne}`;class y{constructor(e){this.hostname=self.location.hostname,this.cache=e}static async getInstance(){if(!y.instance){const e=await caches.open(L);y.instance=new y(e)}return y.instance}async removeOutdatedFiles(){const t=(await caches.keys()).filter(s=>s.startsWith(M)&&s!==L);return Promise.all(t.map(s=>caches.delete(s)))}async cachedFetch(e){if(!this.shouldCacheUrl(new URL(e.url)))return await fetch(e);let t=await this.cache.match(e,{ignoreSearch:!0});return t||(t=await fetch(e),t.ok&&await this.cache.put(e,t.clone())),t}async cacheOfflineModeAssets(){if(!this.shouldCacheUrl(new URL(location.href)))return;const t=await(await fetch("/assets-required-for-offline-mode.json")).json();await this.cache.addAll([...t,"/"])}shouldCacheUrl(e){return e.href.includes("wordpress-static.zip")?!0:e.href.startsWith("http://127.0.0.1:5400/")||e.href.startsWith("http://localhost:5400/")||e.pathname.startsWith("/website-server/")||h(e)||e.pathname.endsWith(".php")?!1:this.hostname===e.hostname}}self.document||(self.document={});self.addEventListener("activate",function(r){r.waitUntil(self.clients.claim())});self.addEventListener("fetch",r=>{const e=new URL(r.request.url);if(e.pathname.startsWith(self.location.pathname)||h(e))return;let t;try{t=new URL(r.request.referrer)}catch{}t&&h(t)||r.respondWith(oe.then(s=>s.cachedFetch(r.request)))});J(self);const oe=y.getInstance().then(r=>(r.cacheOfflineModeAssets(),r.removeOutdatedFiles(),r));te({handleRequest(r){const e=new URL(r.request.url);let t=g(e);if(!t)try{t=g(new URL(r.request.referrer))}catch{}const s=v(e);if(s.pathname.startsWith("/plugin-proxy")||s.pathname.startsWith("/client/index.js"))return;r.preventDefault();async function o(){if(e.pathname.endsWith("/wp-includes/empty.html"))return ae();const i=await N(r);if(i.status===404&&i.headers.get("x-backfill-from")==="remote-host"){const{staticAssetsDirectory:a}=await ce(t);if(!a){const m=i.clone();return m.headers.delete("x-backfill-from"),m}const p=new URL(r.request.url),l=v(p);l.pathname=X(l.pathname,se),!l.pathname.startsWith("/@fs")&&!l.pathname.startsWith("/assets")&&(l.pathname=`/${a}${l.pathname}`);const w=await B(r.request,{url:l,credentials:"omit"});return fetch(w).catch(m=>{if(m?.name==="TypeError")return new Promise(O=>{setTimeout(()=>{O(fetch(w))},Math.random()*1500)});throw m})}if(s.pathname.endsWith("/wp-includes/js/dist/block-editor.js")||s.pathname.endsWith("/wp-includes/js/dist/block-editor.min.js")||s.pathname.endsWith("/build/block-editor/index.js")||s.pathname.endsWith("/build/block-editor/index.min.js")){const a=await i.text(),p=`${ie} ${a.replace(/\(\s*"iframe",/,"(__playground_ControlledIframe,")}`;return new Response(p,{status:i.status,statusText:i.statusText,headers:i.headers})}return i}return o()}});const ie=`
window.__playground_ControlledIframe = window.wp.element.forwardRef(function (props, ref) {
	const source = window.wp.element.useMemo(function () {
		/**
		 * A synchronous function to read a blob URL as text.
		 *
		 * @param {string} url
		 * @returns {string}
		 */
		const __playground_readBlobAsText = function (url) {
			try {
			let xhr = new XMLHttpRequest();
			xhr.open('GET', url, false);
			xhr.overrideMimeType('text/plain;charset=utf-8');
			xhr.send();
			return xhr.responseText;
			} catch(e) {
			return '';
			} finally {
			URL.revokeObjectURL(url);
			}
		};
		if (props.srcDoc) {
			// WordPress <= 6.2 uses a srcDoc that only contains a doctype.
			return '/wp-includes/empty.html';
		} else if (props.src && props.src.startsWith('blob:')) {
			// WordPress 6.3 uses a blob URL with doctype and a list of static assets.
			// Let's pass the document content to empty.html and render it there.
			return '/wp-includes/empty.html#' + encodeURIComponent(__playground_readBlobAsText(props.src));
		} else {
			// WordPress >= 6.4 uses a plain HTTPS URL that needs no correction.
			return props.src;
		}
	}, [props.src]);
	return (
		window.wp.element.createElement('iframe', {
			...props,
			ref: ref,
			src: source,
			// Make sure there's no srcDoc, as it would interfere with the src.
			srcDoc: undefined
		})
	)
});`;function ae(){return new Response("<!doctype html><script>const hash = window.location.hash.substring(1); if ( hash ) document.write(decodeURIComponent(hash))<\/script>",{status:200,headers:{"content-type":"text/html"}})}const R={};async function ce(r){if(!R[r]){const e=await P({method:"getWordPressModuleDetails"},r);R[r]=await I(self,e)}return R[r]}
