"use strict";(self.webpackChunkdocusaurus_classic_typescript=self.webpackChunkdocusaurus_classic_typescript||[]).push([[9378],{9731:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>p,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var n=t(11),o=(t(2735),t(9530));const a={},s="PHP Worker Threads",i={unversionedId:"developers/architecture/browser-php-worker-threads",id:"developers/architecture/browser-php-worker-threads",title:"PHP Worker Threads",description:"PHP is always ran in a web worker to ensure the PHP runtime doesn't slow down the user interface of the main website.",source:"@site/docs/developers/23-architecture/11-browser-php-worker-threads.md",sourceDirName:"developers/23-architecture",slug:"/developers/architecture/browser-php-worker-threads",permalink:"/wordpress-playground/developers/architecture/browser-php-worker-threads",draft:!1,editUrl:"https://github.com/WordPress/wordpress-playground/tree/trunk/packages/docs/site/docs/developers/23-architecture/11-browser-php-worker-threads.md",tags:[],version:"current",sidebarPosition:11,frontMatter:{},sidebar:"developersSidebar",previous:{title:"Iframe-based rendering",permalink:"/wordpress-playground/developers/architecture/browser-iframe-rendering"},next:{title:"Service Workers",permalink:"/wordpress-playground/developers/architecture/browser-service-workers"}},p={},c=[{value:"Initiating web workers",id:"initiating-web-workers",level:3},{value:"Controlling web workers",id:"controlling-web-workers",level:3}],l={toc:c},u="wrapper";function d(e){let{components:r,...t}=e;return(0,o.kt)(u,(0,n.Z)({},l,t,{components:r,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"php-worker-threads"},"PHP Worker Threads"),(0,o.kt)("p",null,"PHP is always ran in a ",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API"},"web worker")," to ensure the PHP runtime doesn't slow down the user interface of the main website."),(0,o.kt)("p",null,"Imagine the following code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'<button onclick="for(let i=0;i<100000000;i++>) {}">Freeze the page</button>\n<input type="text" />\n')),(0,o.kt)("p",null,"As soon as you click that button the browser will freeze and you won't be able to type in the input. That's just how browsers work. Whether it's a for loop or a PHP server, running intensive tasks slows down the user interface."),(0,o.kt)("h3",{id:"initiating-web-workers"},"Initiating web workers"),(0,o.kt)("p",null,"Web workers are separate programs that can process heavy tasks outside of the main application. They must be initiated by the main JavaScript program living in the browser tab. Here's how:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"const phpClient = consumeAPI<PHPClient>(\n    spawnPHPWorkerThread(\n        '/worker-thread.js' // Valid Worker script URL\n    )\n);\nawait phpClient.isReady();\nawait phpClient.run({ code: `<?php echo \"Hello from the thread!\";` });\n")),(0,o.kt)("h3",{id:"controlling-web-workers"},"Controlling web workers"),(0,o.kt)("p",null,"Exchanging messages is the only way to control web workers. The main application has no access to functions or variables inside of a web workeer. It can only send and receive messages using ",(0,o.kt)("inlineCode",{parentName:"p"},"worker.postMessage")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"worker.onmessage = function(msg) { }"),"."),(0,o.kt)("p",null,"This can be tedious, which is why Playground provides a convenient ",(0,o.kt)("a",{parentName:"p",href:"/api/web/function/consumeAPI"},"consumeAPI")," function that abstracts the message exchange and exposes specific functions from the web worker. This is why we can call ",(0,o.kt)("inlineCode",{parentName:"p"},"phpClient.run")," in the example above."))}d.isMDXComponent=!0},9530:(e,r,t)=>{t.d(r,{Zo:()=>l,kt:()=>w});var n=t(2735);function o(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function a(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function s(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?a(Object(t),!0).forEach((function(r){o(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function i(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)t=a[n],r.indexOf(t)>=0||(o[t]=e[t]);return o}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)t=a[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var p=n.createContext({}),c=function(e){var r=n.useContext(p),t=r;return e&&(t="function"==typeof e?e(r):s(s({},r),e)),t},l=function(e){var r=c(e.components);return n.createElement(p.Provider,{value:r},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},h=n.forwardRef((function(e,r){var t=e.components,o=e.mdxType,a=e.originalType,p=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),u=c(t),h=o,w=u["".concat(p,".").concat(h)]||u[h]||d[h]||a;return t?n.createElement(w,s(s({ref:r},l),{},{components:t})):n.createElement(w,s({ref:r},l))}));function w(e,r){var t=arguments,o=r&&r.mdxType;if("string"==typeof e||o){var a=t.length,s=new Array(a);s[0]=h;var i={};for(var p in r)hasOwnProperty.call(r,p)&&(i[p]=r[p]);i.originalType=e,i[u]="string"==typeof e?e:o,s[1]=i;for(var c=2;c<a;c++)s[c]=t[c];return n.createElement.apply(null,s)}return n.createElement.apply(null,t)}h.displayName="MDXCreateElement"}}]);